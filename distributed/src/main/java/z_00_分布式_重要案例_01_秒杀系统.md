
##临界知识


秒杀系统优化思路:减少请求路径长度(CDN缓存,redis缓存,local缓存),减缓请求密度(消息队列),减少请求数量(限流),减少请求数据大小(网络传输,字符编码,CPU处理),
增强服务性能(机器,服务处理,数据库,隔离服务&隔离机器&隔离数据库),简化服务逻辑(减少序列化合并服务,使用字节流避免字符集转换,简化日志,去除spring框架),请求监控

优化分类:业务精简(业务分级),技术高性能

硬件资源:网卡(减少数据),cpu(减少数据,减少逻辑),磁盘(缓存,避免mysql),内存(缓存)

秒杀系统涉及的对象:前端页面资源,服务处理(无状态),后端商品库存(数据库)
秒杀系统涉及过程:页面->下订单->后端服务->mysql

秒杀系统三指标:高可用,高性能,高一致

秒杀系统2/8:热点数据,热点操作(库存读写)
秒杀系统隔离:业务隔离,系统隔离,数据隔离

验证码,安全加盐
消息队列

流量漏斗,令牌桶和漏桶,nginx限流,线程池限流,QPS限流

降级，机房容灾，配置中心
写服务降级，读服务降级，简化系统功能
热点key的读写,分片,容灾,异地多活
防刷,风控，Token 机制
超卖,
物理机cpu，绑核
tomcat,rpc
[秒杀中的redis](https://time.geekbang.org/column/article/307421)
[](https://zhuanlan.zhihu.com/p/92563050)
稳：高可用，系统稳定的提供服务
准：超卖。数据一致性问题,
快：高性能。（优化的点）
安全:恶意请求,刷单
![](.z_00_分布式_重要案例_01_秒杀系统_images/6b36ded2.png)
##秒杀关键点
0.功能模块:详情页耗时,抢购,下单
1.库存表(冻结字段),订单表(支付状态)
1.海量QPS
2.避免超卖,redis lua,mysql update > 0
3.mq削峰
3.分布式订单id
4.库存一致性,补偿机制:下单15min延时消息
5.限购:redis限购(set),mysql限购
6.订单与支付(分布式事务),支付更新库存/订单(支付消息)
7.页面优化技术:缓存预热(秒杀信息),倒计时,CDN,静态化页面
8.可靠性稳定性:qps/线程数限流,异常数降级/异常比率降级,资源隔离
9.恶意爬虫刷单:验证码,限流,黑名单
10.分布式锁:mysql,redis
11.分布式缓存,本地缓存
##秒杀技术栈

nginx lua,epoll,协程,tomcat vs nginx性能

业务隔离,是否扩容,降级,限流
系统隔离,商品详情页,ngnix,dubbo分组,
负载均衡隔离:lvs,haproxy,nginx,DNS  域名 <->ip
数据隔离:


容器化部署

流量控制,削峰,限流,缓存热点,扩容,熔断

重点秒杀详情页、秒杀结算页，商品打标、预约(通知,深度分页)、预约熔断、成本和流量的trade off,事前事中

redis双写一致性,分表分库,redis缓存击穿,爆品热点数据,redis热key问题,深度分页(分表分库,redis,mq,elasticsearch)
[深度分页](https://segmentfault.com/a/1190000023912355)

削峰手段
```asp
削峰的方法有很多，可以通过业务手段来削峰，比如秒杀流程中设置验证码或者问答题环节；也可以通过技术手段削峰，比如采用消息队列异步化用户请求，
或者采用限流漏斗对流量进行层层过滤。削峰又分为无损和有损削峰。本质上，限流是一种有损技术削峰；而引入验证码、问答题以及异步化消息队列可以归为无损削峰
```

