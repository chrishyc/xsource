##临界知识
```asp
二阶段提交协议，不仅仅是协议，也是一种非常经典的思想。二阶段提交在达成提交操 作共识的算法中应用广泛，比如 XA 协议、TCC、Paxos、Raft 等   

幂等性，是指同一操作对同一系统的任意多次执行，所产生的影响均与一次执行的影响 相同，不会因为多次执行而产生副作用。常见的实现方法有 Token、索引等。
它的本质 是通过唯一标识，标记同一操作的方式，来消除多次执行的副作用  

Paxos、Raft 等强一致性算法，也采用了二阶段提交操作，在“提交请求阶段”，只要 大多数节点确认就可以，而具有 ACID 特性的事务，则要求全部节点确认可以。
所以可 以将具有 ACID 特性的操作，理解为最强的一致性
```
##二阶段提交协议
协调者
客户端
```asp
在第一个阶段，每个参与者投票表决事务是放弃还是提交。一旦参与者投票 要求提交事务，那么就不允许放弃事务
在提交请求阶段，需要预留资源，在资源预留期间，其他人不能操作(比如，XA 在第一 阶段会将相关资源锁定);
数据库是独立的系统。
因为上面这两点，我们无法根据业务特点弹性地调整锁的粒度，而这些都会影响数据库的并 发性能
```
1.确认
2.提交/回滚
###在一次面试中被问到一个问题，如果一个transaction的rollback失败了，应该怎么办？
1. 直接重试；2. 触发告警，然后人工根据日志记录进行修复；3. 设计异步回滚流程，也就是说在一个异步流程中对账、回滚，避免因重试耗时而拖慢整体性能。
##TCC
TCC 是 Try(预留)、Confirm(确认)、Cancel(撤销) 
TCC 不依赖于数据库的事务，而是在业务中实现了分布式事务，这样能减轻数据库 的压力，但对业务代码的入侵性也更强，实现的复杂度也更高
