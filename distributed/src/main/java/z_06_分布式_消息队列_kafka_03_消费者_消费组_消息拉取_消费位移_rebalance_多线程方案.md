#
rebalance
#消费组和分区的拓扑
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_多线程方案_images/ff64bca5.png)
每个分区只能被一个消费组内的一个消费组消费
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_多线程方案_images/f5e5dafb.png)
[深入理解kafka3.1]
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_多线程方案_images/5be5357f.png)
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_多线程方案_images/552f548b.png)
##消费者和分区映射策略
#订阅方式
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消费位移_rebalance_多线程方案_images/ac1b66c6.png)
##自动topic
##自动模板
##手动assign(不能rebalance)
#HW
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消息拉取_消费位移_rebalance_多线程方案_images/c0a41856.png)
#消息拉取(批量)
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消息拉取_消费位移_rebalance_多线程方案_images/7a4f57dd.png)
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消息拉取_消费位移_rebalance_多线程方案_images/454bcf6d.png)
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消息拉取_消费位移_rebalance_多线程方案_images/81164589.png)
#消费位移
按分区提交,offset和分区相关
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消息拉取_消费位移_rebalance_多线程方案_images/c45971c7.png)
##自动提交
##异步提交
![](.z_06_分布式_消息队列_kafka_03_消费者_消费组_消息拉取_消费位移_rebalance_多线程方案_images/14198b6a.png)
##同步提交
##批量提交
##重复消费
##消息丢失
##指定位移消费
```asp
指定位移方式:lastest、earlist
指定时间
```
#消费者宕机rebalance
#消费顺序
#消费者两种多线程方案
消费者io:线程=1：1
单线程io:多线程work=1:n
[](https://time.geekbang.org/column/article/108512)
rocketmq多线程怎么维护offset
##Flink多线程维护offset

```
多线程+管理offset
Spark Streaming和Flink
```
##队列维护
```asp
对于第二种方案，可以添加一个共享的队列，消费线程消费完一个记录，就写入队列，然后主线程可以读取这个队列，然后依次提交小号的offset

```
[深入理解kafka核心设计3.2.10]
